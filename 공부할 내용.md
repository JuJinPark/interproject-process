### 공부할 내용
- oauth 인증 및 절차
- mysql naming convention
- 동시성 프로그램밍 화면에 어드민이 여러 명이서 작업할떄
- git flow
- factory method구현후

- exception 처리 및 너무 많은 메서드에서 처리해야하는 문제 
- api key 와 같은 부분은 설정파일에서 받아온느 식으로 변경예정
- 각 api 인스턴스(google,hiworks,github) 이부분을 enum으로 설정후 enum에서 .get instance로 할지 고민중

### 고민하는 내용
- 로그인 절차
    - jwt를 탈취해 다른 사람이 통신에 사용하는 경우(토근자체만 문제가 없으면 유효성 검사에 걸리지 않음) sesion 를 사용? 그러면 jwt사용하는 의미가 퇴색될거 같다.
    - 쿠기를 사용한다면 만료시간과 jwt 만료 시간
    - jwt토큰과 기존 다른 로그인후에 확인하는 절차 
    - vue와 서버가 통신할떄는 당연히 jwt를 기반으로 한다 그러나 뷰자체 라우터로 페이징을 할떄는 권한및 인증 검사를 
      vue-router에는 beforeEnter라는 인터셉터가 있는데 라우팅 직전에 실행되는 함수다. 
      beforeEnter 인터셉터는 from, to, next 세 개 인자를 받는 함수다. 이를 이용해 서버로 페이지 이동마다 인증을 받은후 인증정보가 없을 경우 로그인 화면으로 리다이렉트 하도록 했다.
    - vue와의 통신 방향 라우터러 할시에 서버에서 검증하는 방식 특정 url로 검정을 계속해서 받을 거냐 아님 그냥 요청해서 받을거냐

- 로그인 절차 로직상 
  일단 사내 이메일로 무조건 최초는 로그인(하이웍스)로 한다.
  hiworks와연동하여 accesstoken 과 refreshtoken을 받아온다. 이를 spring redis 에 사번과 함께 저장한다.
  이후 자체 jwt를 발급한다. 여기에 사번또는 세션 아이디를 넣는다.
  프론트는 jwt를 vuex 저장한다 이후 서버와 통신떄마다 jwt를 헤더에 넣어서 보낸다.(아님 모든 작업을 할떄마다 서버에서 jwt 체크후 리다이렉트또는 작업을 할수있게 해야하나,마커이동작업중 토큰 만료만 다 날라가나?)


  서버는 jwt 토큰 유형성 검사 한다(이부분 애매하다. 만약 탈취후 다른 사람이 이jwt를 기반으로 요청을 한다면? 이에 대응하기 위해 세션id를 넣어준다 그럼 jwt 의미가 퇴색 되지않느가 똔느 sessionid가 탈취될수도 있다)

  다른 소셜 로그인일 경우
  hiworks 로그인후 다른 소셜로그인 연동하기 
  이후 해당 소셜로그인 로그인하기 인증되면 이메일 테이블에 소셜 로그인 이메일 추가(redis에 이 accesstoken과 refresh token을 넣어두어야 할까?)

  이후 해당 소셜로그인 으로 로그인하면
  소셜로그인인중후 이메일 테이블레 등록 되어있는지 체크 되었이다면 이후 절차는 하이웍스와 동일

  구글과 같은 다른 api의 기능은 로그인만 한다는 가정이면 굳이 필요한가? 아니라면 하이웍스로그인자도 구글 로그인을 통해 받아와야함 

-RestTemplate을 사용할 때 주의할 점
RestTemplate 은 기본적으로 conneciton pool을 사용하지 않기 때문에 매 요청마다 handshake를 수행한다. 이를 방지하기 위해 다음과 같은 설정을 추가한 Custom RestTemplate을 빈으로 등록하여 사용할 수 있다.(https://a1010100z.tistory.com/entry/SpringBoot-RestTemplate-vs-Webclient작성중)

 
---
### 구현방향

- 직원테이블 동기화
  하이웍스 로그인후 직원테이블에 그 사번이 없으면 새로운 입사한 사람으로 인지후 인서트
  퇴사자는 어드민이 직접제거 방법
  완전동기화를 하게되면 직원테이블에서 자리컬럼만 자리테이블에 사번으로 넣어주면 될까?
- jwt 토큰 검증
- jwt cookie sessionid 로 통신하기
- feature/모듈명 이런식으로 작업 commit 시 깃 issue 닫기
- feature 도 푸시해서 원격으로 작업해라
- 자리중복이 발생하도 자리번호는 직원 테이블에 있으니 사번만 중복이 안일어나면 테이블상에서는 문제없음 -> 관리자페이지에서 중복된 자리는 화면에 계속 보여주게해 처리를 강제한다.
-   
#1. 자체토근 인증법
- 자체 토근 발급후 필터로 모든 요청 마다 token을 있는지 확인 및 없으면 로그인 페이지
- 있으면 제대로 된 토큰 인지와 redis에서 확인?

2. 로그인 accesstoken 받아오기

# 하이웍스(사내이메일) 
- AuthorizationUrl
  param에도 access_type이 있어야함(refresh token을 원할시 offline)
- access token 요청
  post 요청
  body로 (auth_code,client_id,client_secret,grant_type,accesstype)
  accesstoken 만료기간은 리턴값이 없음 한시간이 default 
- resource 요청
  헤더에 (Authorization:Bearer {},Content-type:application/json)

# google
- AuthorizationUrl
  param에도 access_type이 있어야함(refresh token을 원할시 offline)
- access token 요청
  post 요청
  param으로 (code,client_id,client_secret,redirect_url,grant_type)
- resource 요청
  헤더에 (Authorization:Bearer {})  
# github
- AuthorizationUrl
  평범
- access token 요청
  post 요청
  param으로 (client_id,client_secret,code)
  x refresh token 무한 호출가능 아마
- resource 요청
  헤더에 (Authorization:Bearer {})  
#
